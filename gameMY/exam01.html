<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://code.jquery.com/jquery-3.6.4.js"
      integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
      crossorigin="anonymous"
    ></script>
    <style>
      #container {
        position: absolute;
        width: 1000px;
        height: 650px;
        border: 1px black solid;
        /* overflow: hidden; */
        /* max-width: 81px; */
        z-index: 0;
        background-image: url(images/background01.png);
        background-size: cover;
      }

      #pompom {
        position: absolute;
        left: 100px;
        top: 300px;
        width: 100px;
        transform: scaleX(-1);
        /* border: 1px solid; */
        /* display: none; */
      }

      .enemy {
        position: absolute;
        right: 0px;
      }
      #enemy01 {
        position: absolute;
        width: 80px;
        /* top: 10px; */
      }
      #enemy02 {
        position: absolute;
        width: 120px;
        /* top: 20px; */
      }
      #enemy03 {
        position: absolute;
        width: 150px;
        /* top: 40px; */
      }
      #enemy04 {
        position: absolute;
        width: 200px;
        height: 120px;
        /* top: 50px; */
      }
      #clear {
        position: absolute;
        width: 1000px;
        height: 495px;
        text-align: center;
        font-size: xx-large;
        color: blue;
        background-image: url(images/background01.png);
        background-size: cover;
        padding-top: 155px;
        display: none;
        z-index: 1;
      }
      #gameover {
        position: absolute;
        width: 1000px;
        height: 495px;
        text-align: center;
        font-size: xx-large;
        background-image: url(images/background01.png);
        background-size: cover;
        color: red;
        padding-top: 155px;
        display: none;
        z-index: 1;
      }
    </style>
    <script>
      $(function () {
        const enemy = $(".enemy");
        const enemy01 = $("#enemy01");
        const enemy02 = $("#enemy02");
        const enemy03 = $("#enemy03");
        const enemy04 = $("#enemy04");
        const pompom = $("#pompom");
        const gameover = $("#gameover");
        let count = 3;

        gameStart();

        //키보드 이벤트 정의
        $("html").keydown(function (e) {
          switch (e.key) {
            case "ArrowRight":
              moveRight();
              break;
            case "ArrowLeft":
              moveLeft();
              break;
            case "ArrowUp":
              moveUp();
              break;
            case "ArrowDown":
              moveDown();
              break;
          }
          console.log(e.key);
        });

        function gameStart() {
          enemyMoving();
        }

        function gameOver() {
          gameover.css("display", "block");
          
        }

       

        function gameClear() {
          $("#gameclear").css("display", "block");
          $(".enemy").css("display", "none");
        }

        function isColliding(el1, el2) {
          const rect1 = el1.getBoundingClientRect();
          const rect2 = el2.getBoundingClientRect();

          return !(
            rect1.bottom < rect2.top ||
            rect1.top > rect2.bottom ||
            rect1.right < rect2.left ||
            rect1.left > rect2.right ||
            rect1.bottom < rect2.top
          );
        }

        function checkGameOver() {
          for (let i = 0; i <= 3; i++) {
            if (
              $(enemy[i]).is(":visible") &&
              isColliding(pompom[0], enemy[i])
            ) {
              if (
                pompom[0].getBoundingClientRect().width <
                enemy[i].getBoundingClientRect().width
              ) {
                pompom.stop();
                enemy.stop();
                gameOver();
              } else if (
                i === 3 &&
                pompom[0].getBoundingClientRect().width >
                  enemy[i].getBoundingClientRect().width
              ) {
                pompom.stop();
                enemy.stop();
                gameClear();
              } else {
                $(pompom[0]).width(function (i, w) {
                  return w + 5;
                });
                $(pompom[0]).height(function (i, h) {
                  return h + 5;
                });
                $(enemy[i]).hide(); //닿으면 사라짐.. 이 후에 enemy.show() 한 후 위치값...
              }
            }
          }
          setTimeout(checkGameOver, 1000 / 30);
          // }, 1000 / 60);
        }

        // 왼쪽 기준으로 150px 떨어진 곳으로 이동해라
        function moveRight() {
          // 오른쪽 벽에 닿았는지
          const pompomRightMargin = $("#pompom").css("right").replace("px", "");
          if (pompomRightMargin > 0) {
            pompom.animate({ left: "+=20px" }, 0);
          }
          // 보정
          if (pompomRightMargin < 0) {
            pompom.animate({ left: "250px" }, 0);
          }
        }

        function getRandomNumber(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function enemyMoving() {
          const speed = getRandomNumber(2000, 2500);
          enemy.animate({ right: "1000px" }, speed, "linear", function () {
            // score += 200;
            enemy.css("right", "-200px");
            enemy01.animate(
              { top: getRandomNumber(5, 340) + "px" },
              getRandomNumber(2000, 2500),
              "linear"
            );
            enemy02.animate(
              { top: getRandomNumber(5, 340) + "px" },
              getRandomNumber(2500, 2800),
              "linear"
            );
            enemy03.animate(
              { top: getRandomNumber(5, 340) + "px" },
              getRandomNumber(2800, 3000),
              "linear"
            );
            enemy04.animate(
              { top: getRandomNumber(5, 340) + "px" },
              getRandomNumber(3000, 3200),
              "linear"
            );

            enemyMoving();
            checkGameOver();
            enemy.show();
          });
        }

        // 왼쪽 기준으로 50px 떨어진 곳으로 이동해라
        function moveLeft() {
          const pompomLeftMargin = $("#pompom").css("left").replace("px", "");
          if (pompomLeftMargin > 0) {
            pompom.animate({ left: "-=20px" }, 0);
          }
        }

        function moveUp() {
          const pompomTopMargin = $("#pompom").css("top").replace("px", "");
          if (pompomTopMargin > 0) {
            pompom.animate({ top: "-=20px" }, 0);
          }
        }

        function moveDown() {
          const pompomBottomMargin = $("#pompom")
            .css("bottom")
            .replace("px", "");
          if (pompomBottomMargin > 0) {
            pompom.animate({ top: "+=20px" }, 0);
          }
        }
      });
    </script>
  </head>
  <body>
    <div id="container">
      <div id="clear">CLEAR <button onclick="window.location.reload()">재시작</button> </div>
      <div id="gameover">
        Game Over <br />
        <button onclick="window.location.reload()">재시작</button>
      </div>

      <img id="pompom" src="images/whale-removebg-preview.png" alt="" />
      <img id="enemy01" class="enemy" src="images/fish01-removebg-preview.png" alt="" />
      <img id="enemy02" class="enemy" src="images/fish02-removebg-preview.png" alt="" />
      <img id="enemy03" class="enemy" src="images/fish03-removebg-preview.png" alt="" />
      <img id="enemy04" class="enemy" src="images/shark-removebg-preview.png" alt="" />
    </div>
  </body>
</html>
